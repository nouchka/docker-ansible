#!/bin/bash

[ -f "hosts" ] || exit 1
[ ! -f "$HOME/.env" ] || ENV_FILE="--env-file $HOME/.env"
[ ! -d "$HOME/.config/ara/" ] || ARA_DIRECTORY="-v $HOME/.config/ara/:/home/developer/.ara/"

EXECUTABLE=$(basename $0| sed 's/[0-9*.]//g')
VERSION=$(basename $0| sed 's/[a-z-]//g')
if [ "$VERSION" == "" ] || [ ! "$VERSION" ]; then
	VERSION="latest"
fi

docker run -it --rm $ENV_FILE $ARA_DIRECTORY\
	-v $HOME/.ssh/:/home/developer/.ssh/ \
	-v $HOME/.ansible/:/etc/ansible/ \
	-v $HOME/.env:/home/developer/.env:ro \
	-v $(pwd):/home/developer/config \
	nouchka/ansible:$VERSION \
	$EXECUTABLE -i hosts "$@"
